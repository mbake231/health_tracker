{"ast":null,"code":"import _defineProperty from\"@babel/runtime/helpers/defineProperty\";import _classCallCheck from\"@babel/runtime/helpers/classCallCheck\";import _createClass from\"@babel/runtime/helpers/createClass\";import _assertThisInitialized from\"@babel/runtime/helpers/assertThisInitialized\";import _inherits from\"@babel/runtime/helpers/inherits\";import _possibleConstructorReturn from\"@babel/runtime/helpers/possibleConstructorReturn\";import _getPrototypeOf from\"@babel/runtime/helpers/getPrototypeOf\";function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable;})),keys.push.apply(keys,symbols);}return keys;}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?ownKeys(Object(source),!0).forEach(function(key){_defineProperty(target,key,source[key]);}):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key));});}return target;}function _createSuper(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct();return function _createSuperInternal(){var Super=_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget);}else{result=Super.apply(this,arguments);}return _possibleConstructorReturn(this,result);};}function _isNativeReflectConstruct(){if(typeof Reflect===\"undefined\"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy===\"function\")return true;try{Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}));return true;}catch(e){return false;}}import isFunction from'lodash/isFunction';import PropTypes from'prop-types';import XDate from'xdate';import React,{Component}from'react';import ActivityIndicator from\"react-native-web/dist/exports/ActivityIndicator\";import View from\"react-native-web/dist/exports/View\";import FlatList from\"react-native-web/dist/exports/FlatList\";import{extractComponentProps}from\"../../componentUpdater\";import{sameDate}from\"../../dateutils\";import{toMarkingFormat}from\"../../interface\";import styleConstructor from\"./style\";import Reservation from\"./reservation\";import{jsx as _jsx}from\"react/jsx-runtime\";var ReservationList=function(_Component){_inherits(ReservationList,_Component);var _super=_createSuper(ReservationList);function ReservationList(props){var _this;_classCallCheck(this,ReservationList);_this=_super.call(this,props);_this.list=React.createRef();_this.onScroll=function(event){var yOffset=event.nativeEvent.contentOffset.y;_this.props.onScroll==null?void 0:_this.props.onScroll(yOffset);var topRowOffset=0;var topRow;for(topRow=0;topRow<_this.heights.length;topRow++){if(topRowOffset+_this.heights[topRow]/2>=yOffset){break;}topRowOffset+=_this.heights[topRow];}var row=_this.state.reservations[topRow];if(!row)return;var day=row.date;if(day){if(!sameDate(day,_this.selectedDay)&&_this.scrollOver){_this.selectedDay=day.clone();_this.props.onDayChange==null?void 0:_this.props.onDayChange(day.clone());}}};_this.onMoveShouldSetResponderCapture=function(){_this.onListTouch();return false;};_this.renderRow=function(_ref){var item=_ref.item,index=_ref.index;var reservationProps=extractComponentProps(Reservation,_this.props);return _jsx(View,{onLayout:_this.onRowLayoutChange.bind(_assertThisInitialized(_this),index),children:_jsx(Reservation,_objectSpread(_objectSpread({},reservationProps),{},{item:item.reservation,date:item.date}))});};_this.keyExtractor=function(item,index){var _item$reservation;return(_this.props.reservationsKeyExtractor==null?void 0:_this.props.reservationsKeyExtractor(item,index))||\"\"+(item==null?void 0:(_item$reservation=item.reservation)==null?void 0:_item$reservation.day)+index;};_this.style=styleConstructor(props.theme);_this.state={reservations:[]};_this.heights=[];_this.selectedDay=props.selectedDay;_this.scrollOver=true;return _this;}_createClass(ReservationList,[{key:\"componentDidMount\",value:function componentDidMount(){this.updateDataSource(this.getReservations(this.props).reservations);}},{key:\"componentDidUpdate\",value:function componentDidUpdate(prevProps){var _this2=this;if(this.props.topDay&&prevProps.topDay&&prevProps!==this.props){if(!sameDate(prevProps.topDay,this.props.topDay)){this.setState({reservations:[]},function(){return _this2.updateReservations(_this2.props);});}else{this.updateReservations(this.props);}}}},{key:\"updateDataSource\",value:function updateDataSource(reservations){this.setState({reservations:reservations});}},{key:\"updateReservations\",value:function updateReservations(props){var selectedDay=props.selectedDay;var reservations=this.getReservations(props);if(this.list&&!sameDate(selectedDay,this.selectedDay)){var _this$list,_this$list$current;var scrollPosition=0;for(var i=0;i<reservations.scrollPosition;i++){scrollPosition+=this.heights[i]||0;}this.scrollOver=false;(_this$list=this.list)==null?void 0:(_this$list$current=_this$list.current)==null?void 0:_this$list$current.scrollToOffset({offset:scrollPosition,animated:true});}this.selectedDay=selectedDay;this.updateDataSource(reservations.reservations);}},{key:\"getReservationsForDay\",value:function getReservationsForDay(iterator,props){var _props$items;var day=iterator.clone();var res=(_props$items=props.items)==null?void 0:_props$items[toMarkingFormat(day)];if(res&&res.length){return res.map(function(reservation,i){return{reservation:reservation,date:i?undefined:day};});}else if(res){return[{date:iterator.clone()}];}else{return false;}}},{key:\"getReservations\",value:function getReservations(props){var selectedDay=props.selectedDay,showOnlySelectedDayItems=props.showOnlySelectedDayItems;if(!props.items||!selectedDay){return{reservations:[],scrollPosition:0};}var reservations=[];if(this.state.reservations&&this.state.reservations.length){var _this$state$reservati;var _iterator=(_this$state$reservati=this.state.reservations[0].date)==null?void 0:_this$state$reservati.clone();if(_iterator){while(_iterator.getTime()<selectedDay.getTime()){var res=this.getReservationsForDay(_iterator,props);if(!res){reservations=[];break;}else{reservations=reservations.concat(res);}_iterator.addDays(1);}}}var scrollPosition=reservations.length;var iterator=selectedDay.clone();if(showOnlySelectedDayItems){var _res=this.getReservationsForDay(iterator,props);if(_res){reservations=_res;}iterator.addDays(1);}else{for(var i=0;i<31;i++){var _res2=this.getReservationsForDay(iterator,props);if(_res2){reservations=reservations.concat(_res2);}iterator.addDays(1);}}return{reservations:reservations,scrollPosition:scrollPosition};}},{key:\"onListTouch\",value:function onListTouch(){this.scrollOver=true;}},{key:\"onRowLayoutChange\",value:function onRowLayoutChange(index,event){this.heights[index]=event.nativeEvent.layout.height;}},{key:\"render\",value:function render(){var _this$props=this.props,items=_this$props.items,selectedDay=_this$props.selectedDay,theme=_this$props.theme,style=_this$props.style;if(!items||selectedDay&&!items[toMarkingFormat(selectedDay)]){if(isFunction(this.props.renderEmptyData)){var _this$props$renderEmp,_this$props2;return(_this$props$renderEmp=(_this$props2=this.props).renderEmptyData)==null?void 0:_this$props$renderEmp.call(_this$props2);}return _jsx(ActivityIndicator,{style:this.style.indicator,color:theme==null?void 0:theme.indicatorColor});}return _jsx(FlatList,{ref:this.list,style:style,contentContainerStyle:this.style.content,data:this.state.reservations,renderItem:this.renderRow,keyExtractor:this.keyExtractor,showsVerticalScrollIndicator:false,scrollEventThrottle:200,onMoveShouldSetResponderCapture:this.onMoveShouldSetResponderCapture,onScroll:this.onScroll,refreshControl:this.props.refreshControl,refreshing:this.props.refreshing,onRefresh:this.props.onRefresh,onScrollBeginDrag:this.props.onScrollBeginDrag,onScrollEndDrag:this.props.onScrollEndDrag,onMomentumScrollBegin:this.props.onMomentumScrollBegin,onMomentumScrollEnd:this.props.onMomentumScrollEnd});}}]);return ReservationList;}(Component);ReservationList.displayName='ReservationList';ReservationList.propTypes=_objectSpread(_objectSpread({},Reservation.propTypes),{},{items:PropTypes.object,selectedDay:PropTypes.instanceOf(XDate),topDay:PropTypes.instanceOf(XDate),onDayChange:PropTypes.func,showOnlySelectedDayItems:PropTypes.bool,renderEmptyData:PropTypes.func,onScroll:PropTypes.func,onScrollBeginDrag:PropTypes.func,onScrollEndDrag:PropTypes.func,onMomentumScrollBegin:PropTypes.func,onMomentumScrollEnd:PropTypes.func,refreshControl:PropTypes.element,refreshing:PropTypes.bool,onRefresh:PropTypes.func,reservationsKeyExtractor:PropTypes.func});ReservationList.defaultProps={refreshing:false,selectedDay:new XDate(true)};export default ReservationList;","map":{"version":3,"sources":["/Users/mikebaker/health_tracker/client/node_modules/react-native-calendars/src/agenda/reservation-list/index.js"],"names":["isFunction","PropTypes","XDate","React","Component","extractComponentProps","sameDate","toMarkingFormat","styleConstructor","Reservation","ReservationList","props","list","createRef","onScroll","event","yOffset","nativeEvent","contentOffset","y","topRowOffset","topRow","heights","length","row","state","reservations","day","date","selectedDay","scrollOver","clone","onDayChange","onMoveShouldSetResponderCapture","onListTouch","renderRow","item","index","reservationProps","onRowLayoutChange","bind","reservation","keyExtractor","reservationsKeyExtractor","style","theme","updateDataSource","getReservations","prevProps","topDay","setState","updateReservations","scrollPosition","i","current","scrollToOffset","offset","animated","iterator","res","items","map","undefined","showOnlySelectedDayItems","getTime","getReservationsForDay","concat","addDays","layout","height","renderEmptyData","indicator","indicatorColor","content","refreshControl","refreshing","onRefresh","onScrollBeginDrag","onScrollEndDrag","onMomentumScrollBegin","onMomentumScrollEnd","displayName","propTypes","object","instanceOf","func","bool","element","defaultProps"],"mappings":"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","sourcesContent":["import isFunction from 'lodash/isFunction';\nimport PropTypes from 'prop-types';\nimport XDate from 'xdate';\nimport React, { Component } from 'react';\nimport { ActivityIndicator, View, FlatList } from 'react-native';\nimport { extractComponentProps } from '../../componentUpdater';\nimport { sameDate } from '../../dateutils';\nimport { toMarkingFormat } from '../../interface';\nimport styleConstructor from './style';\nimport Reservation from './reservation';\nclass ReservationList extends Component {\n    static displayName = 'ReservationList';\n    static propTypes = {\n        ...Reservation.propTypes,\n        items: PropTypes.object,\n        selectedDay: PropTypes.instanceOf(XDate),\n        topDay: PropTypes.instanceOf(XDate),\n        onDayChange: PropTypes.func,\n        showOnlySelectedDayItems: PropTypes.bool,\n        renderEmptyData: PropTypes.func,\n        onScroll: PropTypes.func,\n        onScrollBeginDrag: PropTypes.func,\n        onScrollEndDrag: PropTypes.func,\n        onMomentumScrollBegin: PropTypes.func,\n        onMomentumScrollEnd: PropTypes.func,\n        refreshControl: PropTypes.element,\n        refreshing: PropTypes.bool,\n        onRefresh: PropTypes.func,\n        reservationsKeyExtractor: PropTypes.func\n    };\n    static defaultProps = {\n        refreshing: false,\n        selectedDay: new XDate(true)\n    };\n    style;\n    heights;\n    selectedDay;\n    scrollOver;\n    list = React.createRef();\n    constructor(props) {\n        super(props);\n        this.style = styleConstructor(props.theme);\n        this.state = {\n            reservations: []\n        };\n        this.heights = [];\n        this.selectedDay = props.selectedDay;\n        this.scrollOver = true;\n    }\n    componentDidMount() {\n        this.updateDataSource(this.getReservations(this.props).reservations);\n    }\n    componentDidUpdate(prevProps) {\n        if (this.props.topDay && prevProps.topDay && prevProps !== this.props) {\n            if (!sameDate(prevProps.topDay, this.props.topDay)) {\n                this.setState({ reservations: [] }, () => this.updateReservations(this.props));\n            }\n            else {\n                this.updateReservations(this.props);\n            }\n        }\n    }\n    updateDataSource(reservations) {\n        this.setState({ reservations });\n    }\n    updateReservations(props) {\n        const { selectedDay } = props;\n        const reservations = this.getReservations(props);\n        if (this.list && !sameDate(selectedDay, this.selectedDay)) {\n            let scrollPosition = 0;\n            for (let i = 0; i < reservations.scrollPosition; i++) {\n                scrollPosition += this.heights[i] || 0;\n            }\n            this.scrollOver = false;\n            this.list?.current?.scrollToOffset({ offset: scrollPosition, animated: true });\n        }\n        this.selectedDay = selectedDay;\n        this.updateDataSource(reservations.reservations);\n    }\n    getReservationsForDay(iterator, props) {\n        const day = iterator.clone();\n        const res = props.items?.[toMarkingFormat(day)];\n        if (res && res.length) {\n            return res.map((reservation, i) => {\n                return {\n                    reservation,\n                    date: i ? undefined : day\n                };\n            });\n        }\n        else if (res) {\n            return [\n                {\n                    date: iterator.clone()\n                }\n            ];\n        }\n        else {\n            return false;\n        }\n    }\n    getReservations(props) {\n        const { selectedDay, showOnlySelectedDayItems } = props;\n        if (!props.items || !selectedDay) {\n            return { reservations: [], scrollPosition: 0 };\n        }\n        let reservations = [];\n        if (this.state.reservations && this.state.reservations.length) {\n            const iterator = this.state.reservations[0].date?.clone();\n            if (iterator) {\n                while (iterator.getTime() < selectedDay.getTime()) {\n                    const res = this.getReservationsForDay(iterator, props);\n                    if (!res) {\n                        reservations = [];\n                        break;\n                    }\n                    else {\n                        reservations = reservations.concat(res);\n                    }\n                    iterator.addDays(1);\n                }\n            }\n        }\n        const scrollPosition = reservations.length;\n        const iterator = selectedDay.clone();\n        if (showOnlySelectedDayItems) {\n            const res = this.getReservationsForDay(iterator, props);\n            if (res) {\n                reservations = res;\n            }\n            iterator.addDays(1);\n        }\n        else {\n            for (let i = 0; i < 31; i++) {\n                const res = this.getReservationsForDay(iterator, props);\n                if (res) {\n                    reservations = reservations.concat(res);\n                }\n                iterator.addDays(1);\n            }\n        }\n        return { reservations, scrollPosition };\n    }\n    onScroll = (event) => {\n        const yOffset = event.nativeEvent.contentOffset.y;\n        this.props.onScroll?.(yOffset);\n        let topRowOffset = 0;\n        let topRow;\n        for (topRow = 0; topRow < this.heights.length; topRow++) {\n            if (topRowOffset + this.heights[topRow] / 2 >= yOffset) {\n                break;\n            }\n            topRowOffset += this.heights[topRow];\n        }\n        const row = this.state.reservations[topRow];\n        if (!row)\n            return;\n        const day = row.date;\n        if (day) {\n            if (!sameDate(day, this.selectedDay) && this.scrollOver) {\n                this.selectedDay = day.clone();\n                this.props.onDayChange?.(day.clone());\n            }\n        }\n    };\n    onListTouch() {\n        this.scrollOver = true;\n    }\n    onRowLayoutChange(index, event) {\n        this.heights[index] = event.nativeEvent.layout.height;\n    }\n    onMoveShouldSetResponderCapture = () => {\n        this.onListTouch();\n        return false;\n    };\n    renderRow = ({ item, index }) => {\n        const reservationProps = extractComponentProps(Reservation, this.props);\n        return (<View onLayout={this.onRowLayoutChange.bind(this, index)}>\n        <Reservation {...reservationProps} item={item.reservation} date={item.date}/>\n      </View>);\n    };\n    keyExtractor = (item, index) => {\n        return this.props.reservationsKeyExtractor?.(item, index) || `${item?.reservation?.day}${index}`;\n    };\n    render() {\n        const { items, selectedDay, theme, style } = this.props;\n        if (!items || selectedDay && !items[toMarkingFormat(selectedDay)]) {\n            if (isFunction(this.props.renderEmptyData)) {\n                return this.props.renderEmptyData?.();\n            }\n            return <ActivityIndicator style={this.style.indicator} color={theme?.indicatorColor}/>;\n        }\n        return (<FlatList ref={this.list} style={style} contentContainerStyle={this.style.content} data={this.state.reservations} renderItem={this.renderRow} keyExtractor={this.keyExtractor} showsVerticalScrollIndicator={false} scrollEventThrottle={200} onMoveShouldSetResponderCapture={this.onMoveShouldSetResponderCapture} onScroll={this.onScroll} refreshControl={this.props.refreshControl} refreshing={this.props.refreshing} onRefresh={this.props.onRefresh} onScrollBeginDrag={this.props.onScrollBeginDrag} onScrollEndDrag={this.props.onScrollEndDrag} onMomentumScrollBegin={this.props.onMomentumScrollBegin} onMomentumScrollEnd={this.props.onMomentumScrollEnd}/>);\n    }\n}\nexport default ReservationList;\n"]},"metadata":{},"sourceType":"module"}