{"ast":null,"code":"import _defineProperty from\"@babel/runtime/helpers/defineProperty\";import _classCallCheck from\"@babel/runtime/helpers/classCallCheck\";import _createClass from\"@babel/runtime/helpers/createClass\";import _inherits from\"@babel/runtime/helpers/inherits\";import _possibleConstructorReturn from\"@babel/runtime/helpers/possibleConstructorReturn\";import _getPrototypeOf from\"@babel/runtime/helpers/getPrototypeOf\";function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable;})),keys.push.apply(keys,symbols);}return keys;}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?ownKeys(Object(source),!0).forEach(function(key){_defineProperty(target,key,source[key]);}):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key));});}return target;}function _createSuper(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct();return function _createSuperInternal(){var Super=_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget);}else{result=Super.apply(this,arguments);}return _possibleConstructorReturn(this,result);};}function _isNativeReflectConstruct(){if(typeof Reflect===\"undefined\"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy===\"function\")return true;try{Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}));return true;}catch(e){return false;}}import PropTypes from'prop-types';import XDate from'xdate';import memoize from'memoize-one';import React,{Component}from'react';import View from\"react-native-web/dist/exports/View\";import Dimensions from\"react-native-web/dist/exports/Dimensions\";import Animated from\"react-native-web/dist/exports/Animated\";import{extractComponentProps}from\"../componentUpdater\";import{parseDate,xdateToData,toMarkingFormat}from\"../interface\";import{sameDate,sameMonth}from\"../dateutils\";import{AGENDA_CALENDAR_KNOB}from\"../testIDs\";import{VelocityTracker}from\"../velocityTracker\";import{getCalendarDateString}from\"../services\";import styleConstructor from\"./style\";import WeekDaysNames from\"../commons/WeekDaysNames\";import CalendarList from\"../calendar-list\";import ReservationList from\"./reservation-list\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var HEADER_HEIGHT=104;var KNOB_HEIGHT=24;var Agenda=function(_Component){_inherits(Agenda,_Component);var _super=_createSuper(Agenda);function Agenda(props){var _this;_classCallCheck(this,Agenda);_this=_super.call(this,props);_this.scrollPad=React.createRef();_this.calendar=React.createRef();_this.knob=React.createRef();_this.list=React.createRef();_this.initialScrollPadPosition=function(){return Math.max(0,_this.viewHeight-HEADER_HEIGHT);};_this.setScrollPadPosition=function(y,animated){var _this$scrollPad,_this$scrollPad$curre;if((_this$scrollPad=_this.scrollPad)!=null&&(_this$scrollPad$curre=_this$scrollPad.current)!=null&&_this$scrollPad$curre.scrollTo){_this.scrollPad.current.scrollTo({x:0,y:y,animated:animated});}else{var _this$scrollPad2,_this$scrollPad2$curr;(_this$scrollPad2=_this.scrollPad)==null?void 0:(_this$scrollPad2$curr=_this$scrollPad2.current)==null?void 0:_this$scrollPad2$curr.getNode().scrollTo({x:0,y:y,animated:animated});}};_this.toggleCalendarPosition=function(open){var maxY=_this.initialScrollPadPosition();_this.setScrollPadPosition(open?0:maxY,true);_this.enableCalendarScrolling(open);};_this.onDayPress=function(d){_this.chooseDay(d,!_this.state.calendarScrollable);};_this.generateMarkings=memoize(function(selectedDay,markedDates,items){if(!markedDates){markedDates={};if(items){Object.keys(items).forEach(function(key){if(items[key]&&items[key].length){markedDates[key]={marked:true};}});}}var key=toMarkingFormat(selectedDay);return _objectSpread(_objectSpread({},markedDates),{},_defineProperty({},key,_objectSpread(_objectSpread({},markedDates[key]||{}),{selected:true})));});_this.onScrollPadLayout=function(){_this.setScrollPadPosition(_this.initialScrollPadPosition(),false);setTimeout(function(){return _this.setState({calendarIsReady:true});},0);};_this.onCalendarListLayout=function(){var _this$calendar,_this$calendar$curren;(_this$calendar=_this.calendar)==null?void 0:(_this$calendar$curren=_this$calendar.current)==null?void 0:_this$calendar$curren.scrollToDay(_this.state.selectedDay.clone(),_this.calendarOffset(),false);};_this.onLayout=function(event){_this.viewHeight=event.nativeEvent.layout.height;_this.viewWidth=event.nativeEvent.layout.width;_this.forceUpdate();};_this.onTouchStart=function(){var _this$knob,_this$knob$current;_this.headerState='touched';(_this$knob=_this.knob)==null?void 0:(_this$knob$current=_this$knob.current)==null?void 0:_this$knob$current.setNativeProps({style:{opacity:0.5}});};_this.onTouchEnd=function(){var _this$knob2,_this$knob2$current;(_this$knob2=_this.knob)==null?void 0:(_this$knob2$current=_this$knob2.current)==null?void 0:_this$knob2$current.setNativeProps({style:{opacity:1}});if(_this.headerState==='touched'){var isOpen=_this.state.calendarScrollable;_this.toggleCalendarPosition(!isOpen);}_this.headerState='idle';};_this.onStartDrag=function(){_this.headerState='dragged';_this.knobTracker.reset();};_this.onSnapAfterDrag=function(e){_this.onTouchEnd();var currentY=e.nativeEvent.contentOffset.y;_this.knobTracker.add(currentY);var projectedY=currentY+_this.knobTracker.estimateSpeed()*250;var maxY=_this.initialScrollPadPosition();var snapY=projectedY>maxY/2?maxY:0;_this.setScrollPadPosition(snapY,true);_this.enableCalendarScrolling(snapY===0);};_this.onVisibleMonthsChange=function(months){_this.props.onVisibleMonthsChange==null?void 0:_this.props.onVisibleMonthsChange(months);if(_this.props.items&&!_this.state.firstReservationLoad){if(_this.scrollTimeout){clearTimeout(_this.scrollTimeout);}_this.scrollTimeout=setTimeout(function(){if(_this._isMounted){_this.props.loadItemsForMonth==null?void 0:_this.props.loadItemsForMonth(months[0]);}},200);}};_this.onDayChange=function(day){var _this$calendar2,_this$calendar2$curre;var withAnimation=sameMonth(day,_this.state.selectedDay);(_this$calendar2=_this.calendar)==null?void 0:(_this$calendar2$curre=_this$calendar2.current)==null?void 0:_this$calendar2$curre.scrollToDay(day,_this.calendarOffset(),withAnimation);_this.setState({selectedDay:day});_this.props.onDayChange==null?void 0:_this.props.onDayChange(xdateToData(day));};_this.renderWeekDaysNames=function(){return _jsx(WeekDaysNames,{firstDay:_this.props.firstDay,style:_this.style.dayHeader});};_this.renderWeekNumbersSpace=function(){return _this.props.showWeekNumbers&&_jsx(View,{style:_this.style.dayHeader});};_this.style=styleConstructor(props.theme);var windowSize=Dimensions.get('window');_this.viewHeight=windowSize.height;_this.viewWidth=windowSize.width;_this.scrollTimeout=undefined;_this.headerState='idle';_this.state={scrollY:new Animated.Value(0),calendarIsReady:false,calendarScrollable:false,firstReservationLoad:false,selectedDay:_this.getSelectedDate(props.selected),topDay:_this.getSelectedDate(props.selected)};_this.currentMonth=_this.state.selectedDay.clone();_this.knobTracker=new VelocityTracker();_this.state.scrollY.addListener(function(_ref){var value=_ref.value;return _this.knobTracker.add(value);});return _this;}_createClass(Agenda,[{key:\"componentDidMount\",value:function componentDidMount(){this._isMounted=true;this.loadReservations(this.props);}},{key:\"componentWillUnmount\",value:function componentWillUnmount(){this._isMounted=false;this.state.scrollY.removeAllListeners();}},{key:\"componentDidUpdate\",value:function componentDidUpdate(prevProps,prevState){var newSelectedDate=this.getSelectedDate(this.props.selected);if(!sameDate(newSelectedDate,prevState.selectedDay)){var prevSelectedDate=this.getSelectedDate(prevProps.selected);if(!sameDate(newSelectedDate,prevSelectedDate)){this.setState({selectedDay:newSelectedDate});}}else if(!prevProps.items){this.loadReservations(this.props);}}},{key:\"getSelectedDate\",value:function getSelectedDate(selected){return selected?parseDate(selected):new XDate(true);}},{key:\"calendarOffset\",value:function calendarOffset(){return 96-this.viewHeight/2;}},{key:\"enableCalendarScrolling\",value:function enableCalendarScrolling(){var _this$props$onCalenda,_this$props,_this$calendar3,_this$calendar3$curre;var enable=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;this.setState({calendarScrollable:enable});(_this$props$onCalenda=(_this$props=this.props).onCalendarToggled)==null?void 0:_this$props$onCalenda.call(_this$props,enable);(_this$calendar3=this.calendar)==null?void 0:(_this$calendar3$curre=_this$calendar3.current)==null?void 0:_this$calendar3$curre.scrollToDay(this.state.selectedDay,this.calendarOffset()+1,true);}},{key:\"loadReservations\",value:function loadReservations(props){var _this2=this;if((!props.items||!Object.keys(props.items).length)&&!this.state.firstReservationLoad){this.setState({firstReservationLoad:true},function(){_this2.props.loadItemsForMonth==null?void 0:_this2.props.loadItemsForMonth(xdateToData(_this2.state.selectedDay));});}}},{key:\"chooseDay\",value:function chooseDay(d,optimisticScroll){var _this$props$onCalenda2,_this$props2,_this$calendar4,_this$calendar4$curre,_this$props$loadItems,_this$props3,_this$props$onDayPres,_this$props4;var day=parseDate(d);this.setState({calendarScrollable:false,selectedDay:day.clone()});(_this$props$onCalenda2=(_this$props2=this.props).onCalendarToggled)==null?void 0:_this$props$onCalenda2.call(_this$props2,false);if(!optimisticScroll){this.setState({topDay:day.clone()});}this.setScrollPadPosition(this.initialScrollPadPosition(),true);(_this$calendar4=this.calendar)==null?void 0:(_this$calendar4$curre=_this$calendar4.current)==null?void 0:_this$calendar4$curre.scrollToDay(day,this.calendarOffset(),true);(_this$props$loadItems=(_this$props3=this.props).loadItemsForMonth)==null?void 0:_this$props$loadItems.call(_this$props3,xdateToData(day));(_this$props$onDayPres=(_this$props4=this.props).onDayPress)==null?void 0:_this$props$onDayPres.call(_this$props4,xdateToData(day));}},{key:\"renderReservations\",value:function renderReservations(){var reservationListProps=extractComponentProps(ReservationList,this.props);return _jsx(ReservationList,_objectSpread(_objectSpread({},reservationListProps),{},{ref:this.list,selectedDay:this.state.selectedDay,topDay:this.state.topDay,onDayChange:this.onDayChange}));}},{key:\"renderCalendarList\",value:function renderCalendarList(){var _this$props5=this.props,markedDates=_this$props5.markedDates,items=_this$props5.items;var shouldHideExtraDays=this.state.calendarScrollable?this.props.hideExtraDays:false;var calendarListProps=extractComponentProps(CalendarList,this.props);return _jsx(CalendarList,_objectSpread(_objectSpread({},calendarListProps),{},{ref:this.calendar,current:getCalendarDateString(this.currentMonth.toString()),markedDates:this.generateMarkings(this.state.selectedDay,markedDates,items),calendarWidth:this.viewWidth,scrollEnabled:this.state.calendarScrollable,hideExtraDays:shouldHideExtraDays,onLayout:this.onCalendarListLayout,onDayPress:this.onDayPress,onVisibleMonthsChange:this.onVisibleMonthsChange}));}},{key:\"renderKnob\",value:function renderKnob(){var _this$props6=this.props,showClosingKnob=_this$props6.showClosingKnob,hideKnob=_this$props6.hideKnob,renderKnob=_this$props6.renderKnob;var knob=_jsx(View,{style:this.style.knobContainer});if(!hideKnob){var knobView=renderKnob?renderKnob():_jsx(View,{style:this.style.knob});knob=!this.state.calendarScrollable||showClosingKnob?_jsx(View,{style:this.style.knobContainer,children:_jsx(View,{ref:this.knob,children:knobView})}):null;}return knob;}},{key:\"render\",value:function render(){var _this$props7=this.props,hideKnob=_this$props7.hideKnob,style=_this$props7.style,testID=_this$props7.testID;var agendaHeight=this.initialScrollPadPosition();var weekdaysStyle=[this.style.weekdays,{opacity:this.state.scrollY.interpolate({inputRange:[agendaHeight-HEADER_HEIGHT,agendaHeight],outputRange:[0,1],extrapolate:'clamp'}),transform:[{translateY:this.state.scrollY.interpolate({inputRange:[Math.max(0,agendaHeight-HEADER_HEIGHT),agendaHeight],outputRange:[-HEADER_HEIGHT,0],extrapolate:'clamp'})}]}];var headerTranslate=this.state.scrollY.interpolate({inputRange:[0,agendaHeight],outputRange:[agendaHeight,0],extrapolate:'clamp'});var contentTranslate=this.state.scrollY.interpolate({inputRange:[0,agendaHeight],outputRange:[0,agendaHeight/2],extrapolate:'clamp'});var headerStyle=[this.style.header,{bottom:agendaHeight,transform:[{translateY:headerTranslate}]}];if(!this.state.calendarIsReady){headerStyle.push({height:0});weekdaysStyle.push({height:HEADER_HEIGHT});}var openCalendarScrollPadPosition=!hideKnob&&this.state.calendarScrollable&&this.props.showClosingKnob?agendaHeight+HEADER_HEIGHT:0;var shouldAllowDragging=!hideKnob&&!this.state.calendarScrollable;var scrollPadPosition=(shouldAllowDragging?HEADER_HEIGHT:openCalendarScrollPadPosition)-KNOB_HEIGHT;var scrollPadStyle={height:KNOB_HEIGHT,top:scrollPadPosition};return _jsxs(View,{testID:testID,onLayout:this.onLayout,style:[style,this.style.container],children:[_jsx(View,{style:this.style.reservations,children:this.renderReservations()}),_jsxs(Animated.View,{style:headerStyle,children:[_jsx(Animated.View,{style:[this.style.animatedContainer,{transform:[{translateY:contentTranslate}]}],children:this.renderCalendarList()}),this.renderKnob()]}),_jsxs(Animated.View,{style:weekdaysStyle,children:[this.renderWeekNumbersSpace(),this.renderWeekDaysNames()]}),_jsx(Animated.ScrollView,{ref:this.scrollPad,style:[this.style.scrollPadStyle,scrollPadStyle],overScrollMode:\"never\",showsHorizontalScrollIndicator:false,showsVerticalScrollIndicator:false,scrollEventThrottle:8,scrollsToTop:false,onTouchStart:this.onTouchStart,onTouchEnd:this.onTouchEnd,onScrollBeginDrag:this.onStartDrag,onScrollEndDrag:this.onSnapAfterDrag,onScroll:Animated.event([{nativeEvent:{contentOffset:{y:this.state.scrollY}}}],{useNativeDriver:true}),children:_jsx(View,{testID:AGENDA_CALENDAR_KNOB,style:{height:agendaHeight+KNOB_HEIGHT},onLayout:this.onScrollPadLayout})})]});}}],[{key:\"getDerivedStateFromProps\",value:function getDerivedStateFromProps(nextProps){if(nextProps.items){return{firstReservationLoad:false};}return null;}}]);return Agenda;}(Component);Agenda.displayName='Agenda';Agenda.propTypes=_objectSpread(_objectSpread(_objectSpread({},CalendarList.propTypes),ReservationList.propTypes),{},{items:PropTypes.object,style:PropTypes.oneOfType([PropTypes.object,PropTypes.array,PropTypes.number]),loadItemsForMonth:PropTypes.func,onCalendarToggled:PropTypes.func,onDayChange:PropTypes.func,renderKnob:PropTypes.func,selected:PropTypes.any,hideKnob:PropTypes.bool,showClosingKnob:PropTypes.bool});export{Agenda as default};","map":{"version":3,"sources":["/Users/mikebaker/health_tracker/client/node_modules/react-native-calendars/src/agenda/index.js"],"names":["PropTypes","XDate","memoize","React","Component","extractComponentProps","parseDate","xdateToData","toMarkingFormat","sameDate","sameMonth","AGENDA_CALENDAR_KNOB","VelocityTracker","getCalendarDateString","styleConstructor","WeekDaysNames","CalendarList","ReservationList","HEADER_HEIGHT","KNOB_HEIGHT","Agenda","props","scrollPad","createRef","calendar","knob","list","initialScrollPadPosition","Math","max","viewHeight","setScrollPadPosition","y","animated","current","scrollTo","x","getNode","toggleCalendarPosition","open","maxY","enableCalendarScrolling","onDayPress","d","chooseDay","state","calendarScrollable","generateMarkings","selectedDay","markedDates","items","Object","keys","forEach","key","length","marked","selected","onScrollPadLayout","setTimeout","setState","calendarIsReady","onCalendarListLayout","scrollToDay","clone","calendarOffset","onLayout","event","nativeEvent","layout","height","viewWidth","width","forceUpdate","onTouchStart","headerState","setNativeProps","style","opacity","onTouchEnd","isOpen","onStartDrag","knobTracker","reset","onSnapAfterDrag","e","currentY","contentOffset","add","projectedY","estimateSpeed","snapY","onVisibleMonthsChange","months","firstReservationLoad","scrollTimeout","clearTimeout","_isMounted","loadItemsForMonth","onDayChange","day","withAnimation","renderWeekDaysNames","firstDay","dayHeader","renderWeekNumbersSpace","showWeekNumbers","theme","windowSize","Dimensions","get","undefined","scrollY","Animated","Value","getSelectedDate","topDay","currentMonth","addListener","value","loadReservations","removeAllListeners","prevProps","prevState","newSelectedDate","prevSelectedDate","enable","onCalendarToggled","optimisticScroll","reservationListProps","shouldHideExtraDays","hideExtraDays","calendarListProps","toString","showClosingKnob","hideKnob","renderKnob","knobContainer","knobView","testID","agendaHeight","weekdaysStyle","weekdays","interpolate","inputRange","outputRange","extrapolate","transform","translateY","headerTranslate","contentTranslate","headerStyle","header","bottom","push","openCalendarScrollPadPosition","shouldAllowDragging","scrollPadPosition","scrollPadStyle","top","container","reservations","renderReservations","animatedContainer","renderCalendarList","useNativeDriver","nextProps","displayName","propTypes","object","oneOfType","array","number","func","any","bool"],"mappings":"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","sourcesContent":["import PropTypes from 'prop-types';\nimport XDate from 'xdate';\nimport memoize from 'memoize-one';\nimport React, { Component } from 'react';\nimport { View, Dimensions, Animated } from 'react-native';\nimport { extractComponentProps } from '../componentUpdater';\nimport { parseDate, xdateToData, toMarkingFormat } from '../interface';\nimport { sameDate, sameMonth } from '../dateutils';\n// @ts-expect-error\nimport { AGENDA_CALENDAR_KNOB } from '../testIDs';\nimport { VelocityTracker } from '../velocityTracker';\nimport { getCalendarDateString } from '../services';\nimport styleConstructor from './style';\nimport WeekDaysNames from '../commons/WeekDaysNames';\nimport CalendarList from '../calendar-list';\nimport ReservationList from './reservation-list';\nconst HEADER_HEIGHT = 104;\nconst KNOB_HEIGHT = 24;\n/**\n * @description: Agenda component\n * @extends: CalendarList\n * @extendslink: docs/CalendarList\n * @example: https://github.com/wix/react-native-calendars/blob/master/example/src/screens/agenda.js\n * @gif: https://github.com/wix/react-native-calendars/blob/master/demo/assets/agenda.gif\n */\nexport default class Agenda extends Component {\n    static displayName = 'Agenda';\n    static propTypes = {\n        ...CalendarList.propTypes,\n        ...ReservationList.propTypes,\n        items: PropTypes.object,\n        style: PropTypes.oneOfType([PropTypes.object, PropTypes.array, PropTypes.number]),\n        loadItemsForMonth: PropTypes.func,\n        onCalendarToggled: PropTypes.func,\n        onDayChange: PropTypes.func,\n        renderKnob: PropTypes.func,\n        selected: PropTypes.any,\n        hideKnob: PropTypes.bool,\n        showClosingKnob: PropTypes.bool\n    };\n    style;\n    viewHeight;\n    viewWidth;\n    scrollTimeout;\n    headerState;\n    currentMonth;\n    knobTracker;\n    _isMounted;\n    scrollPad = React.createRef();\n    calendar = React.createRef();\n    knob = React.createRef();\n    list = React.createRef();\n    constructor(props) {\n        super(props);\n        this.style = styleConstructor(props.theme);\n        const windowSize = Dimensions.get('window');\n        this.viewHeight = windowSize.height;\n        this.viewWidth = windowSize.width;\n        this.scrollTimeout = undefined;\n        this.headerState = 'idle';\n        this.state = {\n            scrollY: new Animated.Value(0),\n            calendarIsReady: false,\n            calendarScrollable: false,\n            firstReservationLoad: false,\n            selectedDay: this.getSelectedDate(props.selected),\n            topDay: this.getSelectedDate(props.selected)\n        };\n        this.currentMonth = this.state.selectedDay.clone();\n        this.knobTracker = new VelocityTracker();\n        this.state.scrollY.addListener(({ value }) => this.knobTracker.add(value));\n    }\n    componentDidMount() {\n        this._isMounted = true;\n        this.loadReservations(this.props);\n    }\n    componentWillUnmount() {\n        this._isMounted = false;\n        this.state.scrollY.removeAllListeners();\n    }\n    componentDidUpdate(prevProps, prevState) {\n        const newSelectedDate = this.getSelectedDate(this.props.selected);\n        if (!sameDate(newSelectedDate, prevState.selectedDay)) {\n            const prevSelectedDate = this.getSelectedDate(prevProps.selected);\n            if (!sameDate(newSelectedDate, prevSelectedDate)) {\n                this.setState({ selectedDay: newSelectedDate });\n            }\n        }\n        else if (!prevProps.items) {\n            this.loadReservations(this.props);\n        }\n    }\n    static getDerivedStateFromProps(nextProps) {\n        if (nextProps.items) {\n            return { firstReservationLoad: false };\n        }\n        return null;\n    }\n    getSelectedDate(selected) {\n        return selected ? parseDate(selected) : new XDate(true);\n    }\n    calendarOffset() {\n        return 96 - this.viewHeight / 2;\n    }\n    initialScrollPadPosition = () => {\n        return Math.max(0, this.viewHeight - HEADER_HEIGHT);\n    };\n    setScrollPadPosition = (y, animated) => {\n        if (this.scrollPad?.current?.scrollTo) {\n            this.scrollPad.current.scrollTo({ x: 0, y, animated });\n        }\n        else {\n            // Support for RN O.61 (Expo 37)\n            this.scrollPad?.current?.getNode().scrollTo({ x: 0, y, animated });\n        }\n    };\n    toggleCalendarPosition = (open) => {\n        const maxY = this.initialScrollPadPosition();\n        this.setScrollPadPosition(open ? 0 : maxY, true);\n        this.enableCalendarScrolling(open);\n    };\n    enableCalendarScrolling(enable = true) {\n        this.setState({ calendarScrollable: enable });\n        this.props.onCalendarToggled?.(enable);\n        // Enlarge calendarOffset here as a workaround on iOS to force repaint.\n        // Otherwise the month after current one or before current one remains invisible.\n        // The problem is caused by overflow: 'hidden' style, which we need for dragging\n        // to be performant.\n        // Another working solution for this bug would be to set removeClippedSubviews={false}\n        // in CalendarList listView, but that might impact performance when scrolling\n        // month list in expanded CalendarList.\n        // Further info https://github.com/facebook/react-native/issues/1831\n        this.calendar?.current?.scrollToDay(this.state.selectedDay, this.calendarOffset() + 1, true);\n    }\n    loadReservations(props) {\n        if ((!props.items || !Object.keys(props.items).length) && !this.state.firstReservationLoad) {\n            this.setState({ firstReservationLoad: true }, () => {\n                this.props.loadItemsForMonth?.(xdateToData(this.state.selectedDay));\n            });\n        }\n    }\n    onDayPress = (d) => {\n        this.chooseDay(d, !this.state.calendarScrollable);\n    };\n    chooseDay(d, optimisticScroll) {\n        const day = parseDate(d);\n        this.setState({\n            calendarScrollable: false,\n            selectedDay: day.clone()\n        });\n        this.props.onCalendarToggled?.(false);\n        if (!optimisticScroll) {\n            this.setState({ topDay: day.clone() });\n        }\n        this.setScrollPadPosition(this.initialScrollPadPosition(), true);\n        this.calendar?.current?.scrollToDay(day, this.calendarOffset(), true);\n        this.props.loadItemsForMonth?.(xdateToData(day));\n        this.props.onDayPress?.(xdateToData(day));\n    }\n    generateMarkings = memoize((selectedDay, markedDates, items) => {\n        if (!markedDates) {\n            markedDates = {};\n            if (items) {\n                Object.keys(items).forEach(key => {\n                    if (items[key] && items[key].length) {\n                        markedDates[key] = { marked: true };\n                    }\n                });\n            }\n        }\n        const key = toMarkingFormat(selectedDay);\n        return { ...markedDates, [key]: { ...(markedDates[key] || {}), ...{ selected: true } } };\n    });\n    onScrollPadLayout = () => {\n        // When user touches knob, the actual component that receives touch events is a ScrollView.\n        // It needs to be scrolled to the bottom, so that when user moves finger downwards,\n        // scroll position actually changes (it would stay at 0, when scrolled to the top).\n        this.setScrollPadPosition(this.initialScrollPadPosition(), false);\n        // delay rendering calendar in full height because otherwise it still flickers sometimes\n        setTimeout(() => this.setState({ calendarIsReady: true }), 0);\n    };\n    onCalendarListLayout = () => {\n        this.calendar?.current?.scrollToDay(this.state.selectedDay.clone(), this.calendarOffset(), false);\n    };\n    onLayout = (event) => {\n        this.viewHeight = event.nativeEvent.layout.height;\n        this.viewWidth = event.nativeEvent.layout.width;\n        this.forceUpdate();\n    };\n    onTouchStart = () => {\n        this.headerState = 'touched';\n        this.knob?.current?.setNativeProps({ style: { opacity: 0.5 } });\n    };\n    onTouchEnd = () => {\n        this.knob?.current?.setNativeProps({ style: { opacity: 1 } });\n        if (this.headerState === 'touched') {\n            const isOpen = this.state.calendarScrollable;\n            this.toggleCalendarPosition(!isOpen);\n        }\n        this.headerState = 'idle';\n    };\n    onStartDrag = () => {\n        this.headerState = 'dragged';\n        this.knobTracker.reset();\n    };\n    onSnapAfterDrag = (e) => {\n        // on Android onTouchEnd is not called if dragging was started\n        this.onTouchEnd();\n        const currentY = e.nativeEvent.contentOffset.y;\n        this.knobTracker.add(currentY);\n        const projectedY = currentY + this.knobTracker.estimateSpeed() * 250; /*ms*/\n        const maxY = this.initialScrollPadPosition();\n        const snapY = projectedY > maxY / 2 ? maxY : 0;\n        this.setScrollPadPosition(snapY, true);\n        this.enableCalendarScrolling(snapY === 0);\n    };\n    onVisibleMonthsChange = (months) => {\n        this.props.onVisibleMonthsChange?.(months);\n        if (this.props.items && !this.state.firstReservationLoad) {\n            if (this.scrollTimeout) {\n                clearTimeout(this.scrollTimeout);\n            }\n            this.scrollTimeout = setTimeout(() => {\n                if (this._isMounted) {\n                    this.props.loadItemsForMonth?.(months[0]);\n                }\n            }, 200);\n        }\n    };\n    onDayChange = (day) => {\n        const withAnimation = sameMonth(day, this.state.selectedDay);\n        this.calendar?.current?.scrollToDay(day, this.calendarOffset(), withAnimation);\n        this.setState({ selectedDay: day });\n        this.props.onDayChange?.(xdateToData(day));\n    };\n    renderReservations() {\n        const reservationListProps = extractComponentProps(ReservationList, this.props);\n        return (<ReservationList {...reservationListProps} ref={this.list} selectedDay={this.state.selectedDay} topDay={this.state.topDay} onDayChange={this.onDayChange}/>);\n    }\n    renderCalendarList() {\n        const { markedDates, items } = this.props;\n        const shouldHideExtraDays = this.state.calendarScrollable ? this.props.hideExtraDays : false;\n        const calendarListProps = extractComponentProps(CalendarList, this.props);\n        return (<CalendarList {...calendarListProps} ref={this.calendar} current={getCalendarDateString(this.currentMonth.toString())} markedDates={this.generateMarkings(this.state.selectedDay, markedDates, items)} calendarWidth={this.viewWidth} scrollEnabled={this.state.calendarScrollable} hideExtraDays={shouldHideExtraDays} onLayout={this.onCalendarListLayout} onDayPress={this.onDayPress} onVisibleMonthsChange={this.onVisibleMonthsChange}/>);\n    }\n    renderKnob() {\n        const { showClosingKnob, hideKnob, renderKnob } = this.props;\n        let knob = <View style={this.style.knobContainer}/>;\n        if (!hideKnob) {\n            const knobView = renderKnob ? renderKnob() : <View style={this.style.knob}/>;\n            knob = !this.state.calendarScrollable || showClosingKnob ? (<View style={this.style.knobContainer}>\n          <View ref={this.knob}>{knobView}</View>\n        </View>) : null;\n        }\n        return knob;\n    }\n    renderWeekDaysNames = () => {\n        return (<WeekDaysNames firstDay={this.props.firstDay} style={this.style.dayHeader}/>);\n    };\n    renderWeekNumbersSpace = () => {\n        return this.props.showWeekNumbers && <View style={this.style.dayHeader}/>;\n    };\n    render() {\n        const { hideKnob, style, testID } = this.props;\n        const agendaHeight = this.initialScrollPadPosition();\n        const weekdaysStyle = [\n            this.style.weekdays,\n            {\n                opacity: this.state.scrollY.interpolate({\n                    inputRange: [agendaHeight - HEADER_HEIGHT, agendaHeight],\n                    outputRange: [0, 1],\n                    extrapolate: 'clamp'\n                }),\n                transform: [\n                    {\n                        translateY: this.state.scrollY.interpolate({\n                            inputRange: [Math.max(0, agendaHeight - HEADER_HEIGHT), agendaHeight],\n                            outputRange: [-HEADER_HEIGHT, 0],\n                            extrapolate: 'clamp'\n                        })\n                    }\n                ]\n            }\n        ];\n        const headerTranslate = this.state.scrollY.interpolate({\n            inputRange: [0, agendaHeight],\n            outputRange: [agendaHeight, 0],\n            extrapolate: 'clamp'\n        });\n        const contentTranslate = this.state.scrollY.interpolate({\n            inputRange: [0, agendaHeight],\n            outputRange: [0, agendaHeight / 2],\n            extrapolate: 'clamp'\n        });\n        const headerStyle = [\n            this.style.header,\n            {\n                bottom: agendaHeight,\n                transform: [{ translateY: headerTranslate }]\n            }\n        ];\n        if (!this.state.calendarIsReady) {\n            // limit header height until everything is setup for calendar dragging\n            headerStyle.push({ height: 0 });\n            // fill header with appStyle.calendarBackground background to reduce flickering\n            weekdaysStyle.push({ height: HEADER_HEIGHT });\n        }\n        const openCalendarScrollPadPosition = !hideKnob && this.state.calendarScrollable && this.props.showClosingKnob ? agendaHeight + HEADER_HEIGHT : 0;\n        const shouldAllowDragging = !hideKnob && !this.state.calendarScrollable;\n        const scrollPadPosition = (shouldAllowDragging ? HEADER_HEIGHT : openCalendarScrollPadPosition) - KNOB_HEIGHT;\n        const scrollPadStyle = {\n            height: KNOB_HEIGHT,\n            top: scrollPadPosition,\n        };\n        return (<View testID={testID} onLayout={this.onLayout} style={[style, this.style.container]}>\n        <View style={this.style.reservations}>{this.renderReservations()}</View>\n        <Animated.View style={headerStyle}>\n          <Animated.View style={[this.style.animatedContainer, { transform: [{ translateY: contentTranslate }] }]}>\n            {this.renderCalendarList()}\n          </Animated.View>\n          {this.renderKnob()}\n        </Animated.View>\n        <Animated.View style={weekdaysStyle}>\n          {this.renderWeekNumbersSpace()}\n          {this.renderWeekDaysNames()}\n        </Animated.View>\n        <Animated.ScrollView ref={this.scrollPad} style={[this.style.scrollPadStyle, scrollPadStyle]} overScrollMode=\"never\" showsHorizontalScrollIndicator={false} showsVerticalScrollIndicator={false} scrollEventThrottle={8} scrollsToTop={false} onTouchStart={this.onTouchStart} onTouchEnd={this.onTouchEnd} onScrollBeginDrag={this.onStartDrag} onScrollEndDrag={this.onSnapAfterDrag} onScroll={Animated.event([{ nativeEvent: { contentOffset: { y: this.state.scrollY } } }], { useNativeDriver: true })}>\n          <View testID={AGENDA_CALENDAR_KNOB} style={{ height: agendaHeight + KNOB_HEIGHT }} onLayout={this.onScrollPadLayout}/>\n        </Animated.ScrollView>\n      </View>);\n    }\n}\n"]},"metadata":{},"sourceType":"module"}