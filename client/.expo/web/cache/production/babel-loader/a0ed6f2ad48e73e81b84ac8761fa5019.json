{"ast":null,"code":"import _defineProperty from\"@babel/runtime/helpers/defineProperty\";function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable;})),keys.push.apply(keys,symbols);}return keys;}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?ownKeys(Object(source),!0).forEach(function(key){_defineProperty(target,key,source[key]);}):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key));});}return target;}import get from'lodash/get';import map from'lodash/map';import isFunction from'lodash/isFunction';import isUndefined from'lodash/isUndefined';import PropTypes from'prop-types';import XDate from'xdate';import React,{useCallback,useContext,useEffect,useRef}from'react';import Text from\"react-native-web/dist/exports/Text\";import SectionList from\"react-native-web/dist/exports/SectionList\";import{isToday,isGTE,sameDate}from\"../dateutils\";import{getMoment}from\"../momentResolver\";import{parseDate}from\"../interface\";import{getDefaultLocale}from\"../services\";import{UpdateSources,todayString}from\"./commons\";import styleConstructor from\"./style\";import constants from\"../commons/constants\";import Context from\"./Context\";import{jsx as _jsx}from\"react/jsx-runtime\";var viewabilityConfig={itemVisiblePercentThreshold:20};var AgendaList=function AgendaList(props){var theme=props.theme,sections=props.sections,scrollToNextEvent=props.scrollToNextEvent,_props$viewOffset=props.viewOffset,viewOffset=_props$viewOffset===void 0?0:_props$viewOffset,avoidDateUpdates=props.avoidDateUpdates,onScroll=props.onScroll,onMomentumScrollBegin=props.onMomentumScrollBegin,onMomentumScrollEnd=props.onMomentumScrollEnd,onScrollToIndexFailed=props.onScrollToIndexFailed,renderSectionHeader=props.renderSectionHeader,sectionStyle=props.sectionStyle,keyExtractor=props.keyExtractor,dayFormatter=props.dayFormatter,_props$dayFormat=props.dayFormat,dayFormat=_props$dayFormat===void 0?'dddd, MMM d':_props$dayFormat,useMoment=props.useMoment,_props$markToday=props.markToday,markToday=_props$markToday===void 0?true:_props$markToday;var _useContext=useContext(Context),date=_useContext.date,updateSource=_useContext.updateSource,setDate=_useContext.setDate,setDisabled=_useContext.setDisabled;var style=useRef(styleConstructor(theme));var list=useRef();var _topSection=useRef(sections[0].title);var didScroll=useRef(false);var sectionScroll=useRef(false);var sectionHeight=useRef(0);useEffect(function(){if(date!==_topSection.current){setTimeout(function(){scrollToSection();},500);}},[]);useEffect(function(){if(updateSource!==UpdateSources.LIST_DRAG&&updateSource!==UpdateSources.CALENDAR_INIT){scrollToSection();}},[date]);var getSectionIndex=function getSectionIndex(date){var i;map(sections,function(section,index){if(section.title===date){i=index;}});return i;};var getNextSectionIndex=function getNextSectionIndex(date){var i=0;for(var j=1;j<sections.length;j++){var prev=parseDate(sections[j-1].title);var next=parseDate(sections[j].title);var cur=parseDate(date);if(isGTE(cur,prev)&&isGTE(next,cur)){i=sameDate(prev,cur)?j-1:j;break;}else if(isGTE(cur,next)){i=j;}}return i;};var getSectionTitle=function getSectionTitle(title){if(!title)return;var sectionTitle=title;if(dayFormatter){sectionTitle=dayFormatter(title);}else if(dayFormat){if(useMoment){var moment=getMoment();sectionTitle=moment(title).format(dayFormat);}else{sectionTitle=new XDate(title).toString(dayFormat);}}if(markToday){var string=getDefaultLocale().today||todayString;var today=isToday(new XDate(title));sectionTitle=today?string+\", \"+sectionTitle:sectionTitle;}return sectionTitle;};var scrollToSection=function scrollToSection(){var sectionIndex=scrollToNextEvent?getNextSectionIndex(date):getSectionIndex(date);if(isUndefined(sectionIndex)){return;}if(list!=null&&list.current&&sectionIndex!==undefined){sectionScroll.current=true;_topSection.current=sections[sectionIndex].title;list==null?void 0:list.current.scrollToLocation({animated:true,sectionIndex:sectionIndex,itemIndex:0,viewPosition:0,viewOffset:(constants.isAndroid?sectionHeight.current:0)+viewOffset});}};var onViewableItemsChanged=useCallback(function(info){if(info!=null&&info.viewableItems&&!sectionScroll.current){var topSection=get(info==null?void 0:info.viewableItems[0],'section.title');if(topSection&&topSection!==_topSection.current){_topSection.current=topSection;if(didScroll.current&&!avoidDateUpdates){setDate==null?void 0:setDate(_topSection.current,UpdateSources.LIST_DRAG);}}}},[_topSection.current,didScroll.current,avoidDateUpdates,setDate]);var _onScroll=useCallback(function(event){if(!didScroll.current){didScroll.current=true;}onScroll==null?void 0:onScroll(event);},[didScroll.current,onScroll]);var _onMomentumScrollBegin=useCallback(function(event){setDisabled==null?void 0:setDisabled(true);onMomentumScrollBegin==null?void 0:onMomentumScrollBegin(event);},[onMomentumScrollBegin]);var _onMomentumScrollEnd=useCallback(function(event){sectionScroll.current=false;setDisabled==null?void 0:setDisabled(false);onMomentumScrollEnd==null?void 0:onMomentumScrollEnd(event);},[onMomentumScrollEnd]);var _onScrollToIndexFailed=useCallback(function(info){if(onScrollToIndexFailed){onScrollToIndexFailed(info);}else{console.log('onScrollToIndexFailed info: ',info);}},[onScrollToIndexFailed]);var onHeaderLayout=useCallback(function(event){sectionHeight.current=event.nativeEvent.layout.height;},[]);var _renderSectionHeader=useCallback(function(info){var _info$section;var title=info==null?void 0:(_info$section=info.section)==null?void 0:_info$section.title;if(renderSectionHeader){return renderSectionHeader(title);}return _jsx(Text,{allowFontScaling:false,style:[style.current.sectionText,sectionStyle],onLayout:onHeaderLayout,children:getSectionTitle(title)});},[]);var _keyExtractor=useCallback(function(item,index){return isFunction(keyExtractor)?keyExtractor(item,index):String(index);},[keyExtractor]);return _jsx(SectionList,_objectSpread(_objectSpread({},props),{},{ref:list,keyExtractor:_keyExtractor,showsVerticalScrollIndicator:false,onViewableItemsChanged:onViewableItemsChanged,viewabilityConfig:viewabilityConfig,renderSectionHeader:_renderSectionHeader,onScroll:_onScroll,onMomentumScrollBegin:_onMomentumScrollBegin,onMomentumScrollEnd:_onMomentumScrollEnd,onScrollToIndexFailed:_onScrollToIndexFailed}));};export default AgendaList;AgendaList.displayName='AgendaList';AgendaList.propTypes={dayFormat:PropTypes.string,dayFormatter:PropTypes.func,useMoment:PropTypes.bool,markToday:PropTypes.bool,sectionStyle:PropTypes.oneOfType([PropTypes.object,PropTypes.number,PropTypes.array]),avoidDateUpdates:PropTypes.bool};AgendaList.defaultProps={dayFormat:'dddd, MMM d',stickySectionHeadersEnabled:true,markToday:true};","map":{"version":3,"sources":["/Users/mikebaker/health_tracker/client/node_modules/react-native-calendars/src/expandableCalendar/agendaList.js"],"names":["get","map","isFunction","isUndefined","PropTypes","XDate","React","useCallback","useContext","useEffect","useRef","isToday","isGTE","sameDate","getMoment","parseDate","getDefaultLocale","UpdateSources","todayString","styleConstructor","constants","Context","viewabilityConfig","itemVisiblePercentThreshold","AgendaList","props","theme","sections","scrollToNextEvent","viewOffset","avoidDateUpdates","onScroll","onMomentumScrollBegin","onMomentumScrollEnd","onScrollToIndexFailed","renderSectionHeader","sectionStyle","keyExtractor","dayFormatter","dayFormat","useMoment","markToday","date","updateSource","setDate","setDisabled","style","list","_topSection","title","didScroll","sectionScroll","sectionHeight","current","setTimeout","scrollToSection","LIST_DRAG","CALENDAR_INIT","getSectionIndex","i","section","index","getNextSectionIndex","j","length","prev","next","cur","getSectionTitle","sectionTitle","moment","format","toString","string","today","sectionIndex","undefined","scrollToLocation","animated","itemIndex","viewPosition","isAndroid","onViewableItemsChanged","info","viewableItems","topSection","_onScroll","event","_onMomentumScrollBegin","_onMomentumScrollEnd","_onScrollToIndexFailed","console","log","onHeaderLayout","nativeEvent","layout","height","_renderSectionHeader","sectionText","_keyExtractor","item","String","displayName","propTypes","func","bool","oneOfType","object","number","array","defaultProps","stickySectionHeadersEnabled"],"mappings":"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","sourcesContent":["import get from 'lodash/get';\nimport map from 'lodash/map';\nimport isFunction from 'lodash/isFunction';\nimport isUndefined from 'lodash/isUndefined';\nimport PropTypes from 'prop-types';\nimport XDate from 'xdate';\nimport React, { useCallback, useContext, useEffect, useRef } from 'react';\nimport { Text, SectionList } from 'react-native';\nimport { isToday, isGTE, sameDate } from '../dateutils';\nimport { getMoment } from '../momentResolver';\nimport { parseDate } from '../interface';\nimport { getDefaultLocale } from '../services';\nimport { UpdateSources, todayString } from './commons';\nimport styleConstructor from './style';\nimport constants from '../commons/constants';\nimport Context from './Context';\nconst viewabilityConfig = {\n    itemVisiblePercentThreshold: 20 // 50 means if 50% of the item is visible\n};\n/**\n * @description: AgendaList component\n * @note: Should be wrapped with 'CalendarProvider'\n * @extends: SectionList\n * @example: https://github.com/wix/react-native-calendars/blob/master/example/src/screens/expandableCalendar.js\n */\nconst AgendaList = (props) => {\n    const { theme, sections, scrollToNextEvent, viewOffset = 0, avoidDateUpdates, onScroll, onMomentumScrollBegin, onMomentumScrollEnd, onScrollToIndexFailed, renderSectionHeader, sectionStyle, keyExtractor, dayFormatter, dayFormat = 'dddd, MMM d', useMoment, markToday = true } = props;\n    const { date, updateSource, setDate, setDisabled } = useContext(Context);\n    const style = useRef(styleConstructor(theme));\n    const list = useRef();\n    const _topSection = useRef(sections[0].title);\n    const didScroll = useRef(false);\n    const sectionScroll = useRef(false);\n    const sectionHeight = useRef(0);\n    useEffect(() => {\n        if (date !== _topSection.current) {\n            setTimeout(() => {\n                scrollToSection();\n            }, 500);\n        }\n    }, []);\n    useEffect(() => {\n        // NOTE: on first init data should set first section to the current date!!!\n        if (updateSource !== UpdateSources.LIST_DRAG && updateSource !== UpdateSources.CALENDAR_INIT) {\n            scrollToSection();\n        }\n    }, [date]);\n    const getSectionIndex = (date) => {\n        let i;\n        map(sections, (section, index) => {\n            // NOTE: sections titles should match current date format!!!\n            if (section.title === date) {\n                i = index;\n            }\n        });\n        return i;\n    };\n    const getNextSectionIndex = (date) => {\n        let i = 0;\n        for (let j = 1; j < sections.length; j++) {\n            const prev = parseDate(sections[j - 1].title);\n            const next = parseDate(sections[j].title);\n            const cur = parseDate(date);\n            if (isGTE(cur, prev) && isGTE(next, cur)) {\n                i = sameDate(prev, cur) ? j - 1 : j;\n                break;\n            }\n            else if (isGTE(cur, next)) {\n                i = j;\n            }\n        }\n        return i;\n    };\n    const getSectionTitle = (title) => {\n        if (!title)\n            return;\n        let sectionTitle = title;\n        if (dayFormatter) {\n            sectionTitle = dayFormatter(title);\n        }\n        else if (dayFormat) {\n            if (useMoment) {\n                const moment = getMoment();\n                sectionTitle = moment(title).format(dayFormat);\n            }\n            else {\n                sectionTitle = new XDate(title).toString(dayFormat);\n            }\n        }\n        if (markToday) {\n            const string = getDefaultLocale().today || todayString;\n            const today = isToday(new XDate(title));\n            sectionTitle = today ? `${string}, ${sectionTitle}` : sectionTitle;\n        }\n        return sectionTitle;\n    };\n    const scrollToSection = () => {\n        const sectionIndex = scrollToNextEvent ? getNextSectionIndex(date) : getSectionIndex(date);\n        if (isUndefined(sectionIndex)) {\n            return;\n        }\n        if (list?.current && sectionIndex !== undefined) {\n            sectionScroll.current = true; // to avoid setDate() in onViewableItemsChanged\n            _topSection.current = sections[sectionIndex].title;\n            list?.current.scrollToLocation({\n                animated: true,\n                sectionIndex: sectionIndex,\n                itemIndex: 0,\n                viewPosition: 0,\n                viewOffset: (constants.isAndroid ? sectionHeight.current : 0) + viewOffset\n            });\n        }\n    };\n    const onViewableItemsChanged = useCallback((info) => {\n        if (info?.viewableItems && !sectionScroll.current) {\n            const topSection = get(info?.viewableItems[0], 'section.title');\n            if (topSection && topSection !== _topSection.current) {\n                _topSection.current = topSection;\n                if (didScroll.current && !avoidDateUpdates) {\n                    // to avoid setDate() on first load (while setting the initial context.date value)\n                    setDate?.(_topSection.current, UpdateSources.LIST_DRAG);\n                }\n            }\n        }\n    }, [_topSection.current, didScroll.current, avoidDateUpdates, setDate]);\n    const _onScroll = useCallback((event) => {\n        if (!didScroll.current) {\n            didScroll.current = true;\n        }\n        onScroll?.(event);\n    }, [didScroll.current, onScroll]);\n    const _onMomentumScrollBegin = useCallback((event) => {\n        setDisabled?.(true);\n        onMomentumScrollBegin?.(event);\n    }, [onMomentumScrollBegin]);\n    const _onMomentumScrollEnd = useCallback((event) => {\n        // when list momentum ends AND when scrollToSection scroll ends\n        sectionScroll.current = false;\n        setDisabled?.(false);\n        onMomentumScrollEnd?.(event);\n    }, [onMomentumScrollEnd]);\n    const _onScrollToIndexFailed = useCallback((info) => {\n        if (onScrollToIndexFailed) {\n            onScrollToIndexFailed(info);\n        }\n        else {\n            console.log('onScrollToIndexFailed info: ', info);\n        }\n    }, [onScrollToIndexFailed]);\n    const onHeaderLayout = useCallback((event) => {\n        sectionHeight.current = event.nativeEvent.layout.height;\n    }, []);\n    const _renderSectionHeader = useCallback((info) => {\n        const title = info?.section?.title;\n        if (renderSectionHeader) {\n            return renderSectionHeader(title);\n        }\n        return (<Text allowFontScaling={false} style={[style.current.sectionText, sectionStyle]} onLayout={onHeaderLayout}>\n        {getSectionTitle(title)}\n      </Text>);\n    }, []);\n    const _keyExtractor = useCallback((item, index) => {\n        return isFunction(keyExtractor) ? keyExtractor(item, index) : String(index);\n    }, [keyExtractor]);\n    return (<SectionList {...props} ref={list} keyExtractor={_keyExtractor} showsVerticalScrollIndicator={false} onViewableItemsChanged={onViewableItemsChanged} viewabilityConfig={viewabilityConfig} renderSectionHeader={_renderSectionHeader} onScroll={_onScroll} onMomentumScrollBegin={_onMomentumScrollBegin} onMomentumScrollEnd={_onMomentumScrollEnd} onScrollToIndexFailed={_onScrollToIndexFailed}/>);\n    // _getItemLayout = (data, index) => {\n    //   return {length: constants.screenWidth, offset: constants.screenWidth * index, index};\n    // }\n};\nexport default AgendaList;\nAgendaList.displayName = 'AgendaList';\nAgendaList.propTypes = {\n    // ...SectionList.propTypes,\n    dayFormat: PropTypes.string,\n    dayFormatter: PropTypes.func,\n    useMoment: PropTypes.bool,\n    markToday: PropTypes.bool,\n    sectionStyle: PropTypes.oneOfType([PropTypes.object, PropTypes.number, PropTypes.array]),\n    avoidDateUpdates: PropTypes.bool\n};\nAgendaList.defaultProps = {\n    dayFormat: 'dddd, MMM d',\n    stickySectionHeadersEnabled: true,\n    markToday: true\n};\n"]},"metadata":{},"sourceType":"module"}